# javac compilation with JDK 7...
$ javac -version src/main/java/bytecode/Display.java
javac 1.7.0_80

# then run with JRE 7...
$ java -cp src/main/java bytecode.Display
bytecode.Display.class -> cafe babe 0000 0033 ...
             major version = 0x33 = 51 = Java 7
Java 7 bytecode running on JVM 1.7


# running with JRE 8: runs smoothly since binary compatibility...
$ java -cp src/main/java bytecode.Display
bytecode.Display.class -> cafe babe 0000 0033 ...
             major version = 0x33 = 51 = Java 7
Java 7 bytecode running on JVM 1.8


# but if run with JRE 6: binary incompatibility...
$ java -cp src/main/java bytecode.Display
Exception in thread "main" java.lang.UnsupportedClassVersionError: bytecode/Display : Unsupported major.minor version 51.0
        at java.lang.ClassLoader.defineClass1(Native Method)
        at java.lang.ClassLoader.defineClassCond(ClassLoader.java:631)
        at java.lang.ClassLoader.defineClass(ClassLoader.java:615)
        at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:141)
        at java.net.URLClassLoader.defineClass(URLClassLoader.java:283)
        at java.net.URLClassLoader.access$000(URLClassLoader.java:58)
        at java.net.URLClassLoader$1.run(URLClassLoader.java:197)
        at java.security.AccessController.doPrivileged(Native Method)
        at java.net.URLClassLoader.findClass(URLClassLoader.java:190)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:306)
        at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:301)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:247)
Could not find the main class: bytecode.Display.  Program will exit.


# Maven compilation with JDK 7...
  <groupId>eu.apachecon</groupId>
  <artifactId>bytecode</artifactId>
  <version>0.0.1-SNAPSHOT</version>

  <name>Bytecode version display</name>

  <properties>
    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
  </properties>

$ mvn clean compile

# then run with JRE 7...
$ java -cp target/classes bytecode.Display
bytecode.Display.class -> cafe babe 0000 0031 ...
             major version = 0x31 = 49 = Java 5
Java 5 bytecode running on JVM 1.7

# generated bytecode is version 5, because forced by maven-compiler-plugin by default


# Maven compilation with JDK 7 but maven.compiler.source & target properties set to 1.6...
  <properties>
    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
    <maven.compiler.source>1.6</maven.compiler.source>
    <maven.compiler.target>1.6</maven.compiler.target>
  </properties>

$ mvn clean compile -f pom-properties.xml
$ java -cp target/classes bytecode.Display
bytecode.Display.class -> cafe babe 0000 0032 ...
             major version = 0x32 = 50 = Java 6
Java 6 bytecode running on JVM 1.7

# this time, execution with JRE 6 doesn't cause any failure...
$ java -cp target/classes bytecode.Display
bytecode.Display.class -> cafe babe 0000 0032 ...
             major version = 0x32 = 50 = Java 6
Java 6 bytecode running on JVM 1.6


# unless a dependency brings in version 7 bytecode...
$ java -cp target/classes:lib/* bytecode.Display2
bytecode.Display2.class -> cafe babe 0000 0032 ...
             major version = 0x32 = 50 = Java 6
Java 6 bytecode running on JVM 1.6
Exception in thread "main" java.lang.UnsupportedClassVersionError: org/apache/lucene/util/IOUtils : Unsupported major.minor version 51.0
        at java.lang.ClassLoader.defineClass1(Native Method)


# enforceBytecodeVersion rule from maven-enforcer-plugin checks dependencies bytecode version...
$ mvn clean compile -f pom-enforcer.xml
[INFO] Scanning for projects...
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building Bytecode version display 0.0.1-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO] 
[INFO] --- maven-clean-plugin:2.5:clean (default-clean) @ bytecode ---
[INFO] Deleting /home/herve/projets/maven/java-evolving/java-evolving-en/bytecode/target
[INFO] 
[INFO] --- maven-enforcer-plugin:1.3.1:enforce (enforce-bytecode-version) @ bytecode ---
[INFO] Restricted to JDK 1.6 yet org.apache.lucene:lucene-core:jar:5.0.0:compile contains org/apache/lucene/LucenePackage.class targeted to JDK 1.7
[WARNING] Rule 0: org.apache.maven.plugins.enforcer.EnforceBytecodeVersion failed with message:
Found Banned Dependency: org.apache.lucene:lucene-core:jar:5.0.0
Use 'mvn dependency:tree' to locate the source of the banned dependencies.
[INFO] ------------------------------------------------------------------------
[INFO] BUILD FAILURE
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 0.967 s
[INFO] Finished at: 2015-09-30T15:44:14+02:00
[INFO] Final Memory: 6M/245M
[INFO] ------------------------------------------------------------------------
[ERROR] Failed to execute goal org.apache.maven.plugins:maven-enforcer-plugin:1.3.1:enforce (enforce-bytecode-version) on project bytecode: Some Enforcer rules have failed. Look above for specific messages explaining why the rule failed. -> [Help 1]
[ERROR] 
[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.
[ERROR] Re-run Maven using the -X switch to enable full debug logging.
[ERROR] 
[ERROR] For more information about the errors and possible solutions, please read the following articles:
[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException

# then detects the issue at compile time...
